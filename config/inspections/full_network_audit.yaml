# =============================================================================
# 全网健康巡检配置
# Full Network Health Audit
# =============================================================================
# 适用场景: 日常巡检、故障前基线、变更后验证
# 覆盖范围: BGP/OSPF路由、接口状态、设备健康、VLAN/MAC
# =============================================================================

name: "Full Network Audit"
description: "全面网络健康检查 - 覆盖路由协议、接口、设备状态"
timeout_seconds: 600

# -----------------------------------------------------------------------------
# 设备范围 (使用 NetBox 动态筛选)
# -----------------------------------------------------------------------------
devices:
  # 方式 1: NetBox 标签筛选 (推荐)
  netbox_filter:
    tag: "olav-managed"        # 检查所有 olav-managed 标签的设备
    status: "active"           # 只检查活跃设备
  
  # 方式 2: 硬编码设备列表 (测试/覆盖用)
  # explicit_devices:
  #   - R1
  #   - R2

# -----------------------------------------------------------------------------
# 检查项目
# -----------------------------------------------------------------------------
checks:
  # ===========================================================================
  # 1. BGP 路由协议检查
  # ===========================================================================
  - name: "BGP 邻居状态"
    intent: "检查所有 BGP 邻居是否处于 Established 状态"
    severity: critical

  - name: "BGP 前缀接收"
    intent: "查看各 BGP 邻居接收的前缀数量，确认路由学习正常"
    severity: warning

  # ===========================================================================
  # 2. OSPF 路由协议检查
  # ===========================================================================
  - name: "OSPF 邻居状态"
    intent: "检查 OSPF 邻居关系是否都是 Full 状态"
    severity: critical

  - name: "OSPF 区域汇总"
    intent: "汇总各 OSPF 区域的邻居数量和接口数量"
    severity: info

  # ===========================================================================
  # 3. 接口状态检查
  # ===========================================================================
  - name: "接口 Up/Down 状态"
    intent: "检查所有物理接口的运行状态，发现 down 的接口"
    severity: warning

  - name: "接口错误计数"
    intent: "检查接口是否有 CRC 错误、输入输出错误"
    severity: warning

  - name: "接口流量利用率"
    intent: "检查接口带宽利用率，发现高负载接口"
    severity: info

  # ===========================================================================
  # 4. 设备健康检查
  # ===========================================================================
  - name: "设备可达性"
    intent: "确认所有设备在线且可管理"
    severity: critical

  - name: "设备基本信息"
    intent: "收集设备型号、软件版本、运行时间"
    severity: info

  # ===========================================================================
  # 5. 二层网络检查
  # ===========================================================================
  - name: "VLAN 配置"
    intent: "汇总各设备的 VLAN 配置情况"
    severity: info

  - name: "MAC 地址表"
    intent: "检查 MAC 地址学习情况，统计各 VLAN 的 MAC 数量"
    severity: info

  - name: "LLDP 邻居"
    intent: "检查 LLDP 邻居发现，验证物理拓扑"
    severity: info

  # ===========================================================================
  # 6. 路由表检查
  # ===========================================================================
  - name: "路由表汇总"
    intent: "统计各设备的路由条目数量，按协议分类"
    severity: info

  - name: "默认路由"
    intent: "确认所有设备都有默认路由"
    severity: warning
