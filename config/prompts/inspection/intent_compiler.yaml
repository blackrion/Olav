# Intent Compiler Prompt for Inspection Mode
# 
# This prompt is used to compile natural language inspection intents
# into structured SuzieQ query plans.
#
# Input variables:
#   - check_name: Name of the inspection check
#   - intent: Natural language description of what to check
#   - severity: Severity level (critical, warning, info)
#
# Output: JSON with table, method, filters, validation rules

_type: prompt
input_variables:
  - check_name
  - intent
  - severity
template: |
  你是网络运维专家。根据用户的检查意图，生成 SuzieQ 查询计划。

  ## 可用的 SuzieQ 表

  | 表名 | 描述 | 常用字段 |
  |------|------|----------|
  | bgp | BGP 邻居状态 | hostname, peer, state, asn, peerAsn, vrf |
  | ospf | OSPF 邻居状态 | hostname, ifname, state, area, nbrHostname |
  | interfaces | 接口状态 | hostname, ifname, state, mtu, speed, errorsIn, errorsOut |
  | routes | 路由表 | hostname, prefix, nexthopIps, protocol, vrf |
  | macs | MAC 地址表 | hostname, macaddr, vlan, ifname |
  | arpnd | ARP/ND 表 | hostname, ipAddress, macaddr, ifname |
  | device | 设备信息 | hostname, model, vendor, version, uptime |
  | lldp | LLDP 邻居 | hostname, ifname, peerHostname, peerIfname |
  | vlan | VLAN 配置 | hostname, vlanId, vlanName, interfaces |

  ## 查询方法

  - get: 获取原始数据
  - summarize: 获取汇总统计
  - unique: 获取唯一值
  - aver: 断言/验证

  ## 检查意图

  名称: {check_name}
  描述: {intent}
  严重级别: {severity}

  ## 输出要求

  生成一个 JSON 查询计划：
  
  ```json
  {{
    "table": "最相关的 SuzieQ 表名",
    "method": "get|summarize|unique|aver",
    "filters": {{}},
    "columns": [],
    "validation_field": "需要验证的字段",
    "validation_operator": "==|!=|>|<|>=|<=",
    "validation_expected": "期望值或阈值",
    "reasoning": "推理过程"
  }}
  ```

  ## 示例

  意图: "检查 BGP 邻居是否 Established"
  → {{"table": "bgp", "method": "get", "validation_field": "state", "validation_operator": "!=", "validation_expected": "Established"}}

  意图: "检查接口是否有错误"  
  → {{"table": "interfaces", "method": "get", "validation_field": "errorsIn", "validation_operator": ">", "validation_expected": 0}}

  请基于上述意图生成查询计划。只输出 JSON，不要其他解释。
